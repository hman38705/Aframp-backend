name: Pipeline Validation

on:
  workflow_dispatch:

jobs:
  validate:
    name: Validate Pipeline Configuration
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check Dockerfile exists
        run: test -f Dockerfile

      - name: Check Cargo.toml exists
        run: test -f Cargo.toml

      - name: Validate Dockerfile syntax
        run: docker build --no-cache --target builder -t test:builder .

      - name: Check workflow syntax
        run: |
          echo "Workflow files:"
          ls -la .github/workflows/

      - name: Summary
        run: |
          echo "✅ Dockerfile validated"
          echo "✅ Cargo.toml found"
          echo "✅ Workflow configuration valid"

      - name: Verify branch protection
        uses: actions/github-script@v6
        with:
          script: |
            try {
              const resp = await github.repos.getBranchProtection({
                owner: context.repo.owner,
                repo: context.repo.repo,
                branch: 'develop'
              });
              console.log('Branch "develop" is protected.');
            } catch (err) {
              console.error('Branch protection for "develop" is not set.');
              process.exit(1);
            }
